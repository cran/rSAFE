<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Anna Gierlak" />

<meta name="date" content="2021-03-29" />

<title>Classification example - HR data</title>


<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Classification example - HR data</h1>
<h4 class="author">Anna Gierlak</h4>
<h4 class="date">2021-03-29</h4>



<p>In this vignette we demonstrate an application of the <code>rSAFE</code> package to the <code>HR_data</code> set. The dataset contains information from a Human Resources department about employees and may be used in the classification task of predicting whether an employee is likely to leave the company. The data comes from the Kaggle competition “Human Resources Analytics” and is available in <code>breakDown</code> and <code>rSAFE</code> packages.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(rSAFE)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">head</span>(HR_data)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="co">#&gt;   satisfaction_level last_evaluation number_project average_monthly_hours</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">#&gt; 1               0.38            0.53              2                   157</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">#&gt; 2               0.80            0.86              5                   262</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co">#&gt; 3               0.11            0.88              7                   272</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co">#&gt; 4               0.72            0.87              5                   223</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co">#&gt; 5               0.37            0.52              2                   159</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co">#&gt; 6               0.41            0.50              2                   153</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co">#&gt;   time_spend_company work_accident left promotion_last_5years sales salary</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="co">#&gt; 1                  3             0    1                     0 sales    low</span></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="co">#&gt; 2                  6             0    1                     0 sales medium</span></a>
<a class="sourceLine" id="cb1-13" title="13"><span class="co">#&gt; 3                  4             0    1                     0 sales medium</span></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="co">#&gt; 4                  5             0    1                     0 sales    low</span></a>
<a class="sourceLine" id="cb1-15" title="15"><span class="co">#&gt; 5                  3             0    1                     0 sales    low</span></a>
<a class="sourceLine" id="cb1-16" title="16"><span class="co">#&gt; 6                  3             0    1                     0 sales    low</span></a></code></pre></div>
<p>As explanatory variables we use all available in the dataset except for  which specifies department in which the employee works for.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">data &lt;-<span class="st"> </span>HR_data[, <span class="kw">colnames</span>(HR_data) <span class="op">!=</span><span class="st"> &quot;sales&quot;</span>]</a></code></pre></div>
<p>In order to ensure the final errors are computed on the data which has not been seen by an appropriate model, we divide our data as follows:</p>
<ul>
<li><code>data1</code> - the data which initial black-box and white-box models are fitted to,</li>
<li><code>data2</code> - the data used to create an <code>explainer</code> and a <code>safe_extractor</code> for black-box model from the previous point, serving also as a test data,</li>
<li><code>data3</code> - the data for which transformations and feature selection are performed, used also as a training set for new models,</li>
<li><code>data4</code> - the data used as a test set for the new models, allowing to compare the results. Before splitting the data, we first shuffle rows to ensure they are evenly distributed.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">set.seed</span>(<span class="dv">111</span>)</a>
<a class="sourceLine" id="cb3-2" title="2">data &lt;-<span class="st"> </span>data[<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(data)),]</a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4">data1 &lt;-<span class="st"> </span>data[<span class="dv">1</span><span class="op">:</span><span class="dv">4000</span>,]</a>
<a class="sourceLine" id="cb3-5" title="5">data2 &lt;-<span class="st"> </span>data[<span class="dv">4001</span><span class="op">:</span><span class="dv">8000</span>,]</a>
<a class="sourceLine" id="cb3-6" title="6">data3 &lt;-<span class="st"> </span>data[<span class="dv">8001</span><span class="op">:</span><span class="dv">12000</span>,]</a>
<a class="sourceLine" id="cb3-7" title="7">data4 &lt;-<span class="st"> </span>data[<span class="dv">12001</span><span class="op">:</span><span class="dv">14999</span>,]</a></code></pre></div>
<div id="building-a-black-box-model" class="section level2">
<h2>Building a black-box model</h2>
<p>In this example we decide to use the GBM model as a black-box - it will serve us as a surrogate.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">n.trees &lt;-<span class="st"> </span><span class="dv">10000</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">library</span>(gbm)</a>
<a class="sourceLine" id="cb4-3" title="3"><span class="kw">set.seed</span>(<span class="dv">111</span>)</a>
<a class="sourceLine" id="cb4-4" title="4">model_xgb1 &lt;-<span class="st"> </span><span class="kw">gbm</span>(left <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> data1, <span class="dt">distribution =</span> <span class="st">&quot;bernoulli&quot;</span>, <span class="dt">n.trees =</span> n.trees)</a></code></pre></div>
</div>
<div id="creating-an-explainer" class="section level2">
<h2>Creating an explainer</h2>
<p>We also create an <code>explainer</code> object that will be used later to create new variables. For classification problems we need to specify <code>predict_function</code> - a function that may be used for model predictions and returns a single numerical value for each observation.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">library</span>(DALEX)</a>
<a class="sourceLine" id="cb5-2" title="2">predict_function &lt;-<span class="st"> </span><span class="cf">function</span>(model, x) <span class="kw">predict</span>(model, x, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>, <span class="dt">n.trees =</span> n.trees)</a>
<a class="sourceLine" id="cb5-3" title="3">explainer_xgb1 &lt;-<span class="st"> </span><span class="kw">explain</span>(model_xgb1, <span class="dt">data =</span> data2[,<span class="op">-</span><span class="dv">7</span>], <span class="dt">y =</span> data2<span class="op">$</span>left, <span class="dt">predict_function =</span> predict_function, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
</div>
<div id="creating-a-safe_extractor" class="section level2">
<h2>Creating a safe_extractor</h2>
<p>Now, we create a <code>safe_extractor</code> object using <code>rSAFE</code> package and our surrogate model. Setting the argument <code>verbose=FALSE</code> stops progress bar from printing.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">safe_extractor &lt;-<span class="st"> </span><span class="kw">safe_extraction</span>(explainer_xgb1, <span class="dt">penalty =</span> <span class="dv">20</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>Now, let’s print summary for the new object we have just created.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">print</span>(safe_extractor)</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="co">#&gt; Variable &#39;satisfaction_level&#39; - selected intervals:</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="co">#&gt;  (-Inf, 0.48]</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="co">#&gt;      (0.48, 0.9193878]</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co">#&gt;      (0.9193878, Inf)</span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="co">#&gt; Variable &#39;last_evaluation&#39; - selected intervals:</span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="co">#&gt;  (-Inf, 0.42]</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co">#&gt;      (0.42, 0.57]</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="co">#&gt;      (0.57, 0.8]</span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="co">#&gt;      (0.8, Inf)</span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="co">#&gt; Variable &#39;number_project&#39; - selected intervals:</span></a>
<a class="sourceLine" id="cb7-12" title="12"><span class="co">#&gt;  (-Inf, 4]</span></a>
<a class="sourceLine" id="cb7-13" title="13"><span class="co">#&gt;      (4, Inf)</span></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="co">#&gt; Variable &#39;average_monthly_hours&#39; - selected intervals:</span></a>
<a class="sourceLine" id="cb7-15" title="15"><span class="co">#&gt;  (-Inf, 115.6122]</span></a>
<a class="sourceLine" id="cb7-16" title="16"><span class="co">#&gt;      (115.6122, 160]</span></a>
<a class="sourceLine" id="cb7-17" title="17"><span class="co">#&gt;      (160, 214]</span></a>
<a class="sourceLine" id="cb7-18" title="18"><span class="co">#&gt;      (214, Inf)</span></a>
<a class="sourceLine" id="cb7-19" title="19"><span class="co">#&gt; Variable &#39;time_spend_company&#39; - selected intervals:</span></a>
<a class="sourceLine" id="cb7-20" title="20"><span class="co">#&gt;  (-Inf, 3]</span></a>
<a class="sourceLine" id="cb7-21" title="21"><span class="co">#&gt;      (3, Inf)</span></a>
<a class="sourceLine" id="cb7-22" title="22"><span class="co">#&gt; Variable &#39;work_accident&#39; - no transformation suggested.</span></a>
<a class="sourceLine" id="cb7-23" title="23"><span class="co">#&gt; Variable &#39;promotion_last_5years&#39; - no transformation suggested.</span></a>
<a class="sourceLine" id="cb7-24" title="24"><span class="co">#&gt; Variable &#39;salary&#39; - created levels:</span></a>
<a class="sourceLine" id="cb7-25" title="25"><span class="co">#&gt;  high -&gt;  high </span></a>
<a class="sourceLine" id="cb7-26" title="26"><span class="co">#&gt;  low, medium -&gt;  low_medium</span></a></code></pre></div>
<p>We can see transformation propositions for all variables in our dataset.</p>
<p>In the plot below we can see which points have been chosen to be the breakpoints for a particular variable:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">plot</span>(safe_extractor, <span class="dt">variable =</span> <span class="st">&quot;last_evaluation&quot;</span>)</a></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAqAAAAEgCAMAAABcujGyAAABMlBMVEUAAAAAADoAOmYAOpAAZpAAZrY2H7M2H8I2S7M2S8I2S9I2c9I2c+E3HqM6AAA6AGY6OpA6kNtDeL9dH6NdH7NdH8JdS6NdS7NdS8JdS9Jdc8Jdc9Jdc+FdmeFdmfBmAABmADpmAGZmOjpmZmZmtv+AH6OAH7OAS6OAS7OAS9KAc6OAc8KAmeGAmfCAvOGAvPCAvP+QOgCQOjqQkGaQ2/+iS6OiS8Kic7Oic8KimbOimcKimeGivNKivPCi3uGi3vCi3v+2ZgC2Zjq2///Bc6PBc7PBmbPBvOHB3tLB3vDB3v/B/+HB//DB///b///hmbPhmcLhvMLhvNLhvOHh3tLh3uHh3v/h/+Hh///l5eX/AAD/tmb/vML/25D/3tL/3uH/3vD//7b//9v//+H///D////bpy/TAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAUWklEQVR4nO2djX/ctB2Hw16Skp3HuLQdY+z2RiiMQQ/WwIB1pON4WVk5Cmxk5UhGE////8L0akm25LN1tvyz830+n8JFlmzLfk5vlnV7OQCE2Rv6BACoA4IC0kBQQBoICkgDQQFpICggDQQFpIGggDQQFJAGggLSRAp6dZItdz721cnBIzfk4gNvxPOjmf64ySS/vHsWe1hrb51ycSfLZo+zhSdfIJpIQc+PssNoQzSVGxlSxyNoFn/8ngRl31km6AaCdkukoOv92/unux47TtCFSPrVnWhDexL08vhAXREI2iFxgl4eHz6WpuzCDoLyU4htZPQmqP7GQNAOiROUacIKDHkXrj4+yvbfKH1cifKVq8Du1r8+zrKX8qt32X/PSpvYLi7evc3qxhcesmKZ19zcP1Y8Zjfuil1evMpSfeMRlH0SgUVcdSC+I2cXq/0P2ZGfvV/emz+GlRv7NPLSAdYHn9/JDtinx7dVHHHyB4+sKr6UHEQRJyiXbCVLMNH0kl5ZHx0L/8RD756obSVBWWtWwEK1oGsZ8pKIxj+96BNUllgmLtvbe2pHzi5Wxf6dvfljWFmwY+Qyp+YAa56pwzMVnbc2KoKWk4MoogQVbqgSbJ09+5DdeXHXzEfbQl7SPGY38WH+Jb+TJUFX2W+YZxfHXApZ+W6yZ/8p+sRLnpgVuo+PMo+gIrUbN7ubX614XCuYHWD/Pt84c/bmj2FnwY6hDmgOsNbfA5Yy/+qIn5T8whSCVpKDKKIEXcsbIoscdacW9kdX0KWOLJoF5Sre2qUUVEZgkWcsQLTr1kFBrbjsQIvcOYYIZvotctkgsPfmj1HNgoyhDmgOsFZVhowjdlwStJIcRBEjqK7YTLkhsD46FkqPuYt+Qa/+/elfX80KQYu9s+JWldK+TpJIbcfVtrD928HW8ay9BWJYWXBiqJDiAEzQpZVjkRFX0GpyEEWMoLrZmBXlhiAkKLcwLCjvO2nbhYise66QLbo8ICg/nB1X+8PcsYMdQYu9BWI4ubFiCKwDVARlW1xBq8lBFDGCrtVYpLktgjhBWQPw9Q8+/c/aKkHNLa0rQWWVbOI6JahlRaAE9cZwStCyWS1LUIjZCRGCyvZkLhtz6q6ZylzaJLv468wnqLNJ3WPZvlNtUNOvqGmDyrOw4jptUKtrYvRz2qDeGNUsWLht0GW+pQ2K3lEnRAi60c2q8yNxq1i/90L0hJyPLM5XRz5B3U3Ms/vyMbYQ9GfiHu/fZSk+kR7NVOTi4MWTJNnjL+Iyf4rOuLML27lib4EYVhbsGAL7AFLQ+l58KTmIIkLQomwQHXTVG+A3x/poRhwrgpY2rXRbbSZTsVv9sWm8ecZB3c6HicuKs9tFm8/ahaWfvTd/DCsLdgyVXXOAtTMILOKXBK0kB1G0F7R4hKTKSfHs5SXZFjMfz+9k+29426ClTTxNduPP34jq90tZVvLHM2o/F/z5k2eyyAv3VUARl/nzIZPi12dusK2fszd/DCsL9mmI3FkHWOsvafEkqSJoOTmIYjrzQXWDcLwHAB4gKJ0DAA8QlM4BgAcISucAwMN0BAWTBIIC0kBQQBoICkgDQQFpICggDQQFpIGggDRxgvI3FsOj1hcP3b83anbJ2peGRT6/GR4Ar9sWYGMmEEWkBrSIeydJvvAbmJFbsUIZc3nsScAjQ1AQJEbQlZyKuQ68DhYS1GsLBAW1RL3yYV7JuPVeJt9gLGYXL+SsYx12eZztvy+M4eHydcqZTqimKJ/ffJ8lXOZFInmUbP9vtx6JbeybcH7zb0dq5/LoboDabXE4tScIOnoiBLXuupqFPhPFqRB3ffCIbzdhi2KGsw7n/4opyKIE5ZOV11z0WVEu64R8m0wgVu+QEeWhrQC9W51K7wmCjp4YQW+ZKvRoqapUZuf/uFlMCW6FDhP/XxtBxd8b7p0qhaWgS/FBJ+LhOqHeJv+v/igO7aRk/9Gp9J4g6OjZsQS9eVosQrSQ72PsC0F1mCgPldFCUPG3lLjYg/iD/cfsSBWkLKFIq1Uz/7E/c0HVbnUqvScIOnp2aINeviI9050l8SKwkk+HtRPU6nXtKKh+7xSCjp2ohRtUL142N/ONGt0UlmxkCVqEqbqXfy7CNyqhDiw0s4ZJi7aA2rZFULXboqpXe4Kgo2e3cVAhgPiTKcGt4AvD8RJWh/G1s7ydJG0Oj6w104lkeKmTVCuo6STNVCdJ7gmCjp64J0kr9SRJCsDHdOQyH9n+35lwKzWcJBe008NM2mY5zFSYwyIXrulEHJVQDDPN8i2CeoeZ9utHWMEoIP0sfoOV4a49VAXlNb0YzQTXG6qCioEq+AnICgoAB4IC0kBQQBoICkgDQQFpICggDQRNz4OXhz6DEQFB0wNBWwBBu2VexWz84bd7P/rDvfzBH/f2Xs6fvv2Xvb3nv2P/hjvbEQBBu6VW0AfP5989wwT98RffP/fR07d+mn//c/bvuY+GO136QNB0/PD7j1i5eU9U8Q9e5p/4vx9+d2/oE6MMBE3H97/4Qij5j3sQtDEQNB1WCfr0LQjaDAiaEN0GFQ1PCNoICJoQ1ov/yduiF/+MlBOCbgWCpgV99pZA0HQ8fWuPF52gDRAUkAaCAtJAUEAaCApIA0EBaSAoIA0EBaSBoIA0EBSQBoIC0kBQQBoICkgDQQFpICggDQQFpIGggDQQFJAGggLSQFBAGggKSANBAWkgKCANBAWkgaCANBAUkAaCAtJAUEAaCApIA0EBaSIEvTxeVgM3nrDGKb3hAOSdCdpMsfiU4LoCQQFpYgVdZVnGzTo/4h/4fw/PTJQ1C1ywbTzGZv9Ux2YpRWJrDyLlt0LSjUjENr55LPcNQKygqxmzkJknHNxkS7cclFsWVycsVr46PNOxbUGtMCks2wv7MGP/WCjfAkCsoJevnOZCzs3BIx1mR2AFId+0ZlvZH0VsS1A7TPy7OhGJ9k9Faln4AhDfBt1kosiThjqCbkTxxxzjofIPHduq4k2Y+CeVVInQMgWKSEFZI/PgM67U1UmmNSvgjclMBLN6nNXwRWxbUCvMErSkMLj2xAkqbCqq4RWvlyslqPh08Ll2r1TF22EoQUGQOEFF03Oju9raOytC8el1FrOILSLKFqYdVm6DQlBQEF+CXh5nC1lY6p5NgeiDr8R/spkuKFlslvLq5PCMNQuWVtii3IuHoKAgvg26f8oV5O1NaWJ5HFT0nmQpq2PL0jLL3rT3sKqMg0JQUIDJIoA0NYKymliNcjLObz0Kx9yJJ0962vGoTqEbJpMRQ42gfIxoVvxxAEHpM5mMGMKC8mc9Rbm5udFbCQpADWFBuZzigSTj6p3PICgYgmaCrhdWG/S/APROK0EvXzvrr5MErivzJpEcQcXkTjWCaQu6WvbYiwfXlXkTQ21B5fxNjekk8bH1DHOIQce0FrT0+MYZZsI46BgYV0YiSlBHUFZw8sp+JZ6yQ9AxMKqMzFsLWsyPB6B/GvlZquIzq5MEQK+0FxSAhEBQQJlmTdCSoHweZ7YIRAWgQ5r56QrKXxPO3cnxAPRDhKD6beC0nSQCQyMETqEbxpQRCDqqU+iGEWWkYRMUVTwYhoZ+xnSShp6IBabAfF6/3S8oAGloWsNDUDAITf00gopVP/CoE6ShvaAAJCRKUAwzjZ3RZKRxExSCEjmFbhhNRhr7aQm6zjSzmvgAdECMoFixCyQjTlAA0tC8CeoKyheRdV/tBKAHmvvpCipe4iwMtVa328hFQAHohEhBS71489rx+c1TvFAHuqMTQZ3V7fJimabOITA0QuAUumEkGWnRBK2ZbmcvHsa32Ut8dwmBi0rgFLqhSUZayNEXbU7B7cVvrOl2jqDnR6YNmmY6Vgq2zPiaJHPO4OewPY5fUJtSCTrBNmibmmYqsCzPQ/lOdjXiS1CbkqC9tUGHY06hukuMyLDf0GTf11YHCk+3S9VJGgx+ma6boEoNXyHKy9akJ9GMRj+iwKv381/11EkaDH6ZrlkRWmTXY+g82dXoSlBrdbv1FGcxq9pu6NNIiJ3ZsqHzZN/Xdk0Jq4ovZjPRm243Dzbs49G1XcNTGAVbMuJcQveKWlejb9rdSd84aNo5TQ3smBd0eNy53ve1EbRSZtoFqjdKH7S8i8NPWG6Aadl3Z6nVHOtkf/SptjpNiLka6U+jnjEIamUpRtK5twC297n7KY6BajYtQatBvZ1GvKBUVxbxfPOrhFN7Y3mqt4nju0Tzas3et6Fta0DPo05y0+oDo8qNDC1ZWS0y8mtShNaNzQeqlrpvbnS3oG2CEcyob5Ylf6xyve4pMhofYdSEnm7K0SVvTJ9+LSov/+bWRo9B0IbRvFXY3B9QCY44rzFRp1Gld683lP0KtJUCF94vcOsrXVk8bNnbvLoA28Z4GmfJ+3WvRpKVWukUJiJo6FrWlFvViyQeAatgY1i4tPTtwQ7zjbc2x33l4/Db4+XWl5I6nnv15En99uZzw0ox+UXyROKBpQ1M0MYHIU3gWnovhNnoiW5S2EVhcA/2pmpU66/aM3HwCSrmiyyJDTO1+MqVK5Nws6tmRHCCtM5dpVre1hna0ioNlKaNoC9om7g1z5qdLZ6av91ZjYo0j4fqukxWv6vtnt1xUF7F0xoHbZejutk6tfucchFKIGv+wZNGhF/5oEHbykn9L6JWaxd/PJD47hXzUFunpD7MFOVZxD2hcBd7gYSfuZ7Nt5ugpV87pkDMg4r2xWdO5j52Dpl8SUHbpxt+8bDacdAo01pfB34KVG7kTpSvZdR3tR9kydE+XamTNMBrHXWCxuQoIo0UlMqtbExVP/daxnxX+yPyZGj/HHfKy0voXjakfnySlp55bBFAupOU9ALTupsNmNe0t7ePrQ9A14Jaq9udHw0yCy/pFe78hvatiHlG7jsyOT0j8fzSnDbRvHYsni+lX38x8TXu9nA1z1U6O4I5UOXIPR43LeEZ9dbCDRvWeRpgDCrxVe7ytipJ+jTF7Nv5LkxLz7p3kspL36Qfg0p9nbu6sZYvflk6kSg0U3NSerYQ1AxBNZwv1ZTgdLt0i7CpU+jmgFIS6y/v9mp4+8NUQ548GXzluq7wCSrbmf71Qde9jT0Fx0HTlQTqFLoofHwtwvLmeexTFXe/nsDJvOBv8I2DyqFQR9D15LtILQ/pr0p9NWygrbhj/qZWkwcJDzPZq9v1V36GGeAGVO56oEUXaOwFGoC6xCxt3k2x6+Jns9Xt+I8opGaQO+CbSe730NNFD/ZPAr2XnQyFoPbqdqss/fvyg9yASs+4ol1pRMfdEN5tTdEaeaIQdFiGuQHucE119nOpILQ+Rw3v7CJobMqxQVbQgQ7rG04s+t0VC/2FaZvDNTylaljM4cbI8IL6h0aS3oCtozOBVmRhSqww29P5vjBhsSc+zERo4Ya0JcT2+xpoRdZPKWqAX3t3u4lnNSj80acuaLOFG1Iwnhpsm2KNktf0/ytRy8ETh+Z78WO6AR3YErLUNzK14xdidBAVdOgTSE+wb+aNmO68hobkwg3X6QY4lIa5rutlsCG5cMO1vjHQ0yFimKn3mVaTmTIG4tlB0I6pDo0kLzomMzozmYwY/NPtUg40QdDumExGDN53koYdCkXjCxj8r3wMOtIEP4GBnqAoQIGF/7XjQRZpUsBPYOH9Ia8B3kAqQAEKbIYfZioBP4HN8IKWhkaGEHQyozOTyYjBEZSvEZZ8+cXympYpj+09hREzmYwY3CXAF1cny2KNG2t1u7x4AblvUMMDh/Iw02ohlgrjmNeO+aY0xSq6SMClLOh6pueDOgs3ZC+mKUHhJ3BxX/kQdqpBUHvpm6/P0lTxKEBBCUdQ1gjNV5kaBHUXD7ME7XGOFebZAYVXUIegoP2BAhSUCf+QVypBraGRofyczOjMZDJiCP+Ql91JgqDjYDIZMdT8kJc9zJSkikcNDyrU/JCXWd0uTyRo70cAo2P4Z/EFKEBBFUqCDn0CgCDDLx6mQQEKPNBZPAx+Ag/Dr81U/AZMyoN6T2H8TCYjBjqCpjym/xTGz2QyYiCzeBhqeOCDyuJh6CIBL1SGmeAn8EJkdTssaAdcfIIOuHQtClDgx+0kJf89OQVaoCBAuYpfZVniZUX40MjAfk5mdGYyGTF42qCr5OOgQxegk7mvk8mIwVOCpl/ZDhU8COE+i09ev0sgKAgRfuUjHUPX8IAwFAbq4ScIMvziYShAQQ01i4f1C35PDTShZvGwPij/1h+DwNAIgVPohslkxBBePMxeftFZibE1HiutYpPARSVwCt0wmYwYwouH2e/FO6/IN6ReSwAaEV48zFpZxF1kpA5YCbql0eJh7jJNdZOkLC1TzcsCk2QHQQFIBwQFpIGggDRhQaM6SREQGBohcArdMJmMGGqexe84zNQUAheVwCl0w2QyYqgR1Fp+UX0EIDUUZjMBEASCAtJAUEAaCApIA0EBaSAoIA0EBaSBoIA06QR1ZuWn+fHkHXBfJxhmzdQWWKd7fjTM4gatKO7/1nc10gnqPC5NvLxOe+znvIdn5zeJ33JzuuK9HepX9/JYn+HWh+jJBHUmnGxuEC9BSzNlqGOd7hhmnq2zF9X93z4NKZmg9oW7eucz4oKW5hpSxzpd/pPVfb6X2wVfn+mLuv3rNIig6wX1u26d7ebwk4FWTW2O8+0/yYj7mZtvPU1BL187G5OgrIe0Id7tsC/u8YJ+G5S4oKsl+XrTKUHPRL1JmdG9/UBQUNMcVr/6TfqWl3od1AUdWSfJCEqok+QOKFAvQZ1hpkXqH99rjzldvrbBeKp4QsNM9gT9EQhqnS0fqKddgDqnO56B+kbvauBRJyANBAWkgaCANBAUkAaCAtJAUEAaCApIA0EBaSAoIA0EBaSBoIA0EBSQBoIC0kBQQBoICkgDQQFpICggDQQFpIGggDQQFJAGggLSQFBAGggKSANBAWkgKCANBAWkgaCANBAUkOb/GxblF+UwQPoAAAAASUVORK5CYII=" /><!-- --></p>
<p>For factor variables we can observe in which order levels have been merged and what is the optimal clustering:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">plot</span>(safe_extractor, <span class="dt">variable =</span> <span class="st">&quot;salary&quot;</span>)</a></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAqAAAAEgCAMAAABcujGyAAABklBMVEUAv8QAv88Av9gAxdUAyuIAzNoA1dgA1ewzv8Qzv8kzxckz0uA2H7M2H8I2S7M2S8I2S9I2c+E3HqM6v8Q6v886v9g6yuI64PVcv8Rc2OVdH6NdS6NdS8Jdc9JdmeFdmfBmv8Rmv89mv9hm6uxm6vVm6v+AH6OAS6OAS7OAc6OAc8KAmeGAmfCAvPCAvP+AxcSA3+WQysSQys+Q1cSQ4NiQ6uKQ9P+iS6Oic7Oic8KimeGivPCi3v+jzMSj5eW21cS2///Bc6PBc7PBmbPBvNLBvOHB3v/B/+HB///F0snF5eXb4M/b/+zb///hmbPhvMLhvNLh3tLh3uHh3v/h//Dh///l06vl39Xl5b/l5drl5eDl5eXosILo5eXs5eXv0+Xydm31dm31doL1sNL4dm34dof4dpf4dqD4iqv4j7n4ptH5dm35dof5dqD5vej7dm371P/8j238vaD81Ln86f/8///+vYf+////vML/1KD/3tL/3uH/6bn/6tj/9OL//9H//+H//+j//+z///D///X///+yjG7SAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAIWklEQVR4nO3ciXcTVRiG8RTQqhTUiIJxq0txF+pSxI3WHSpVQUWNC2oQd1EBoSUF2+b/9s4kbRIPp81hJvX9eJ/fwSRTQ07uvc+ZyUw1lRYgrPJ/vwFgPQQKaQQKaQQKaQQKaQQKaQQKaQQKaQQKaQQKadcU6PKBHe+W/UaAqyFQSCNQSCNQSNso0PfvqVbHnvw4e7jwYnpcvfft1UC72625He88Wt3xZu22/IkXqg8M+23DxQaBzlVzWXjztfbjsVfagfZsp0AfT0/66ED2uNWaad8Bxa0f6JW9WWsLeXgz1ftTpgt70+4xD7RnO3WcN9nedc7Xbt+Utw4HGwb68n9+NLcaaM92+yZ7erarnas+U/77hKkNDvEz6Ri+88nj7Y3lY28dfKzaDXRte63J7J4zKJRog0CXX88/Z96aklt+sf2ZczXQnu21QLOjO0d4lGjjy0zHDqaT9duznenYEy+9dXyu+xl0bXst0OxfcIRHiQa6DjqfPlu2P1+mBDuB9m53P3ZeqD7NER4lWj/Q+dqt2WXO96tZoNn50sKj1bVAu9vdQK/s3VnjIijKM8BJUudaZ+dhdrjvHOLXtntO3GeqXARFiQb5TVL1vmw3uvx6LTuj/7B228ftk6Tudk+gF6rt3yYBpSj7vwed4decKFPJgX5Q4xQJZSo10Jn2VVGgNKUG+kZ17KkyXw/g/0mCNAKFNAKFNALFUDW3TC/umrr2v0+gGKoUaKG/T6AYKgKFgMVdL9xRqexeTDcTrdbKZKWSdbk0Xhl5Pj/E50f5/L73eYNYP9A6pFS0dN/YiZu2HqkfrmQ3I699vu+Gev3w1iOf7dle/2zPyGsnbt6f/qQnpfve56071MEChRbZ1Vq8Y2L1ZtdUs733nMjvZ/v3oL3PG+iVZYeMq5BdrdUA85vZ9v519+y2o2n7zv5D/FTvkwcgO2Rchexq9QeahZkQqB3Z1eoLrznSbi8/xDe3EKgP2dXqC29lMu06U6VL46Ppo2ge6NL47nRuP0Kg1znZ1eoPL7vMlO1Fu5eZWtmFpYcfJNDrnOFqGQ45MMPVMhxyYIarZTjkwAxXy3DIgRmuluGQAzNcLcMhB2a4WoZDDsxwtQyHHJjhahkOOTDD1TIccmCGq2U45MAMV8twyIEZrpbhkAMzXC3DIQdmuFqGQw7McLUMhxyY4WoZDjkww9UyHHJghqtlOOTADFeLr76JpLLxU64XgwUKLYarZTjkwAxXy3DIgRmuluGQAzNcLcMhB2a4WoZDDsxwtQyHHJjhahkOOTDD1TIccmCGq2U45MAMV8twyIEZrpbhkAMzXC3DIQdmuFqGQw7McLUMhxyY4WoZDjkww9UyHHJghqtlOOTADFfLcMiBGa6W4ZADM1wtwyEHZrhahkMOzHC1DIccmOFqGQ45MMPVMhxyYIarVeCbRSrYdJv0tR4CBgu0QNsYAsMpJ9BIDKecQCMxnHICjcRwygk0EsMpJ9BIDKecQCMxnHICjcRwygk0EsMpJ9BIDKecQCMxnHICjcRwygk0EsMpJ9BIDKecQCMxnHICjcRwygk0EsMpJ9BIDKecQCMxnHICjcRwygk0EsMpJ9BIDKecQCMxnHICjcRwygk0EsMpL/LNIpv0HRNYYzTlgwVaoG0MgeGUE2gkhlNOoJEYTjmBRmI45QQaieGUE2gkhlNOoJEYTjmBRmI45QQaieGUE2gkhlNOoJEYTjmBRmI45QQaieGUE2gkhlNOoJEYTjmBRmI45QQaieGUE2gkhlNOoJEYTjmBRmI45QQaieGUE2gkmlO+uGtqeC9OoJFoTjmBokNzygkUHZpTngW6MlmpjKbb3a1WszLRah0aLenF+WaRSCpaOu/qxM37P993Qz375/DWI/VXb9meHt9dcKiDBVqgbdhIe9Dmlum069wyvXjn9Mqzz287mu5LenECRVFZoNuO5vcrkxOLd7330PRstl0KAkVRPYGmz57N0ZXJR7LPouUgUBSVBToylR/iW81tz020Zm98sLTzegJFUfmhPTuFT2fuS+Mp1WaltCM8gaKw7mWm5FBqc2m8tCM8gUIbgUIagUIagUIagUIagUIagUIagUIagUIagUIagUIagUIagUIagUIagUIagUIagUIagUIagUIagUIaX30DSYMFuq7Gtf9VYEAECmkECmkECmkECmkECmkECmkECmkECmkECmkECmkECmkECmkECmkECmkECmkECmkECmkECmkECmkECmkECmkECmkECmkECmkFvlmksUnfMQFHgwW6LvagGD4ChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTS+WQSSBgt0XexBMXwECmkECmkECmkECmkECmkECmkECmkECmkECmkECmkECmkECmkECmkECmkECmkECmkECmkECmkECmkECmkEiqIu/XK2777/YUEEiqKuUiOBQgeBQtqlX/5sNBpn8iov/9449dev51Z/VFyRbxaBuU4In3zzw5f1L77/6pNvv/705Hf1T0+mh50f/a/fLALkLv18Jj+opz8XT59rtc6fPrf6o+IvTqAoKg+xHej5H/9OD7ND/FkChQgChbSeQPNDfLohUOjoCfTy77+lE3kChZKeQPPLTH8SKJRdzD6IloVAUaKLp862/vnjpxJfkUBRpvONRqPMPgkU2ggU0ggU0ggU0ggU0ggU0ggU0ggU0ggU0ggU0ggU0ggU0ggU0ggU0ggU0ggU0ggU0ggU0ggU0ggU0ggU0ggU0ggU0ggU0ggU0ggU0ggU0ggU0ggU0ggU0ggU0v4Fn8rI3npgHcoAAAAASUVORK5CYII=" /><!-- --></p>
</div>
<div id="transforming-data" class="section level2">
<h2>Transforming data</h2>
<p>Now we can use our <code>safe_extractor</code> object to create new categorical features in the given dataset.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">data3_trans &lt;-<span class="st"> </span><span class="kw">safely_transform_data</span>(safe_extractor, data3, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<table>
<colgroup>
<col width="2%"></col>
<col width="7%"></col>
<col width="6%"></col>
<col width="5%"></col>
<col width="8%"></col>
<col width="7%"></col>
<col width="5%"></col>
<col width="1%"></col>
<col width="8%"></col>
<col width="8%"></col>
<col width="7%"></col>
<col width="7%"></col>
<col width="9%"></col>
<col width="8%"></col>
<col width="4%"></col>
</colgroup>
<thead>
<tr class="header">
<th align="left">salary</th>
<th align="right">satisfaction_level</th>
<th align="right">last_evaluation</th>
<th align="right">number_project</th>
<th align="right">average_monthly_hours</th>
<th align="right">time_spend_company</th>
<th align="right">work_accident</th>
<th align="right">left</th>
<th align="right">promotion_last_5years</th>
<th align="left">satisfaction_level_new</th>
<th align="left">last_evaluation_new</th>
<th align="left">number_project_new</th>
<th align="left">average_monthly_hours_new</th>
<th align="left">time_spend_company_new</th>
<th align="left">salary_new</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">low</td>
<td align="right">0.78</td>
<td align="right">0.77</td>
<td align="right">2</td>
<td align="right">177</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">(0.48, 0.9193878]</td>
<td align="left">(0.57, 0.8]</td>
<td align="left">(-Inf, 4]</td>
<td align="left">(160, 214]</td>
<td align="left">(3, Inf)</td>
<td align="left">low_medium</td>
</tr>
<tr class="even">
<td align="left">low</td>
<td align="right">0.87</td>
<td align="right">0.94</td>
<td align="right">5</td>
<td align="right">219</td>
<td align="right">5</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">(0.48, 0.9193878]</td>
<td align="left">(0.8, Inf)</td>
<td align="left">(4, Inf)</td>
<td align="left">(214, Inf)</td>
<td align="left">(3, Inf)</td>
<td align="left">low_medium</td>
</tr>
<tr class="odd">
<td align="left">medium</td>
<td align="right">0.85</td>
<td align="right">1.00</td>
<td align="right">5</td>
<td align="right">244</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">(0.48, 0.9193878]</td>
<td align="left">(0.8, Inf)</td>
<td align="left">(4, Inf)</td>
<td align="left">(214, Inf)</td>
<td align="left">(-Inf, 3]</td>
<td align="left">low_medium</td>
</tr>
<tr class="even">
<td align="left">medium</td>
<td align="right">0.24</td>
<td align="right">0.46</td>
<td align="right">7</td>
<td align="right">224</td>
<td align="right">5</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">(-Inf, 0.48]</td>
<td align="left">(0.42, 0.57]</td>
<td align="left">(4, Inf)</td>
<td align="left">(214, Inf)</td>
<td align="left">(3, Inf)</td>
<td align="left">low_medium</td>
</tr>
<tr class="odd">
<td align="left">low</td>
<td align="right">0.81</td>
<td align="right">0.49</td>
<td align="right">4</td>
<td align="right">285</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">(0.48, 0.9193878]</td>
<td align="left">(0.42, 0.57]</td>
<td align="left">(-Inf, 4]</td>
<td align="left">(214, Inf)</td>
<td align="left">(3, Inf)</td>
<td align="left">low_medium</td>
</tr>
<tr class="even">
<td align="left">high</td>
<td align="right">0.72</td>
<td align="right">0.84</td>
<td align="right">2</td>
<td align="right">173</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">(0.48, 0.9193878]</td>
<td align="left">(0.8, Inf)</td>
<td align="left">(-Inf, 4]</td>
<td align="left">(160, 214]</td>
<td align="left">(-Inf, 3]</td>
<td align="left">high</td>
</tr>
</tbody>
</table>
<p>We can also perform feature selection if we wish. For each original feature it keeps exactly one of their forms - original one or transformed one.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">selected_variables &lt;-<span class="st"> </span><span class="kw">safely_select_variables</span>(safe_extractor, data3_trans, <span class="dt">which_y =</span> <span class="st">&quot;left&quot;</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb11-2" title="2">data3_trans_sel &lt;-<span class="st"> </span>data3_trans[,<span class="kw">c</span>(<span class="st">&quot;left&quot;</span>, selected_variables)]</a>
<a class="sourceLine" id="cb11-3" title="3"><span class="kw">print</span>(selected_variables)</a>
<a class="sourceLine" id="cb11-4" title="4"><span class="co">#&gt; [1] &quot;work_accident&quot;             &quot;promotion_last_5years&quot;    </span></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="co">#&gt; [3] &quot;salary&quot;                    &quot;satisfaction_level_new&quot;   </span></a>
<a class="sourceLine" id="cb11-6" title="6"><span class="co">#&gt; [5] &quot;last_evaluation_new&quot;       &quot;number_project_new&quot;       </span></a>
<a class="sourceLine" id="cb11-7" title="7"><span class="co">#&gt; [7] &quot;average_monthly_hours_new&quot; &quot;time_spend_company_new&quot;</span></a></code></pre></div>
<p>It can be observed that for some features the original form was preferred and for others the transformed one.</p>
<p>Here are the first few rows for our data after feature selection:</p>
<table style="width:100%;">
<colgroup>
<col width="3%"></col>
<col width="8%"></col>
<col width="13%"></col>
<col width="4%"></col>
<col width="14%"></col>
<col width="12%"></col>
<col width="11%"></col>
<col width="16%"></col>
<col width="14%"></col>
</colgroup>
<thead>
<tr class="header">
<th align="right">left</th>
<th align="right">work_accident</th>
<th align="right">promotion_last_5years</th>
<th align="left">salary</th>
<th align="left">satisfaction_level_new</th>
<th align="left">last_evaluation_new</th>
<th align="left">number_project_new</th>
<th align="left">average_monthly_hours_new</th>
<th align="left">time_spend_company_new</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">low</td>
<td align="left">(0.48, 0.9193878]</td>
<td align="left">(0.57, 0.8]</td>
<td align="left">(-Inf, 4]</td>
<td align="left">(160, 214]</td>
<td align="left">(3, Inf)</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">low</td>
<td align="left">(0.48, 0.9193878]</td>
<td align="left">(0.8, Inf)</td>
<td align="left">(4, Inf)</td>
<td align="left">(214, Inf)</td>
<td align="left">(3, Inf)</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">medium</td>
<td align="left">(0.48, 0.9193878]</td>
<td align="left">(0.8, Inf)</td>
<td align="left">(4, Inf)</td>
<td align="left">(214, Inf)</td>
<td align="left">(-Inf, 3]</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">medium</td>
<td align="left">(-Inf, 0.48]</td>
<td align="left">(0.42, 0.57]</td>
<td align="left">(4, Inf)</td>
<td align="left">(214, Inf)</td>
<td align="left">(3, Inf)</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">low</td>
<td align="left">(0.48, 0.9193878]</td>
<td align="left">(0.42, 0.57]</td>
<td align="left">(-Inf, 4]</td>
<td align="left">(214, Inf)</td>
<td align="left">(3, Inf)</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">high</td>
<td align="left">(0.48, 0.9193878]</td>
<td align="left">(0.8, Inf)</td>
<td align="left">(-Inf, 4]</td>
<td align="left">(160, 214]</td>
<td align="left">(-Inf, 3]</td>
</tr>
</tbody>
</table>
<p>Now, we perform transformations on another data that will be used later to compare models performance.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">data4_trans &lt;-<span class="st"> </span><span class="kw">safely_transform_data</span>(safe_extractor, data4, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb12-2" title="2">data4_trans_sel &lt;-<span class="st"> </span>data4_trans[,<span class="kw">c</span>(<span class="st">&quot;left&quot;</span>, selected_variables)]</a></code></pre></div>
</div>
<div id="creating-white-box-models-on-original-and-transformed-datasets" class="section level2">
<h2>Creating white-box models on original and transformed datasets</h2>
<p>Let’s fit the models to data containing newly created columns. We consider a generalized linear model (glm) as a white-box model.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">model_lr2 &lt;-<span class="st"> </span><span class="kw">glm</span>(left <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> data3_trans_sel, <span class="dt">family =</span> <span class="kw">binomial</span>())</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">set.seed</span>(<span class="dv">111</span>)</a>
<a class="sourceLine" id="cb13-3" title="3">model_xgb2 &lt;-<span class="st"> </span><span class="kw">gbm</span>(left <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> data3_trans_sel, <span class="dt">distribution =</span> <span class="st">&quot;bernoulli&quot;</span>, <span class="dt">n.trees =</span> n.trees)</a></code></pre></div>
<p>Moreover, we create a glm model based on original data in order to check if our methodology improves results.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">model_lr1 &lt;-<span class="st"> </span><span class="kw">glm</span>(left <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> data1, <span class="dt">family =</span> <span class="kw">binomial</span>())</a></code></pre></div>
</div>
<div id="comparing-models-performance" class="section level2">
<h2>Comparing models performance</h2>
<p>Final step is the comparison of all four models we have created. For each of them we make predictions on the relevant test set, i.e. we use <code>model_lr1</code> and <code>model_xgb1</code> to predict the output for <code>data2</code> and <code>model_lr2</code> and <code>model_xgb2</code> to predict the output for <code>data4</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">pred_lr1 &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">predict</span>(model_lr1, data2, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>))</a>
<a class="sourceLine" id="cb15-2" title="2">pred_xgb1 &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">predict</span>(model_xgb1, data2, <span class="dt">n.trees =</span> n.trees, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>))</a>
<a class="sourceLine" id="cb15-3" title="3">pred_lr2 &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">predict</span>(model_lr2, data4_trans_sel, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>))</a>
<a class="sourceLine" id="cb15-4" title="4">pred_xgb2 &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">predict</span>(model_xgb2, data4_trans_sel, <span class="dt">n.trees =</span> n.trees, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>))</a></code></pre></div>
<p>The performance of the models may then be evaluated based on confusion matrices with relative percentages obtained via the <code>confusion_matrix</code> function:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">confusion_matrix &lt;-<span class="st"> </span><span class="cf">function</span>(y_true, y_pred) {</a>
<a class="sourceLine" id="cb16-2" title="2">  cm &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">pred_0 =</span> <span class="kw">c</span>(<span class="kw">sum</span>(y_true<span class="op">==</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>y_pred<span class="op">==</span><span class="dv">0</span>)<span class="op">/</span><span class="kw">sum</span>(y_true<span class="op">==</span><span class="dv">0</span>),</a>
<a class="sourceLine" id="cb16-3" title="3">                              <span class="kw">sum</span>(y_true<span class="op">==</span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>y_pred<span class="op">==</span><span class="dv">0</span>)<span class="op">/</span><span class="kw">sum</span>(y_true<span class="op">==</span><span class="dv">1</span>)),</a>
<a class="sourceLine" id="cb16-4" title="4">                   <span class="dt">pred_1 =</span> <span class="kw">c</span>(<span class="kw">sum</span>(y_true<span class="op">==</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>y_pred<span class="op">==</span><span class="dv">1</span>)<span class="op">/</span><span class="kw">sum</span>(y_true<span class="op">==</span><span class="dv">0</span>),</a>
<a class="sourceLine" id="cb16-5" title="5">                              <span class="kw">sum</span>(y_true<span class="op">==</span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>y_pred<span class="op">==</span><span class="dv">1</span>)<span class="op">/</span><span class="kw">sum</span>(y_true<span class="op">==</span><span class="dv">1</span>)))</a>
<a class="sourceLine" id="cb16-6" title="6">  cm &lt;-<span class="st"> </span><span class="kw">apply</span>(cm, <span class="dt">MARGIN =</span> <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="kw">round</span>(x, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb16-7" title="7">  <span class="kw">rownames</span>(cm) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;actual_0&quot;</span>, <span class="st">&quot;actual_1&quot;</span>)</a>
<a class="sourceLine" id="cb16-8" title="8">  cm</a>
<a class="sourceLine" id="cb16-9" title="9">}</a></code></pre></div>
<p>GBM models give the following results:</p>
<ul>
<li>for the original data:</li>
</ul>
<table style="width:71%;">
<colgroup>
<col width="20%"></col>
<col width="25%"></col>
<col width="25%"></col>
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center"><strong>predicted 0</strong></th>
<th align="center"><strong>predicted 1</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>actual 0</strong></td>
<td align="center">0.97</td>
<td align="center">0.03</td>
</tr>
<tr class="even">
<td align="center"><strong>actual 1</strong></td>
<td align="center">0.09</td>
<td align="center">0.91</td>
</tr>
</tbody>
</table>
<ul>
<li>for the data with <code>rSAFE</code> transformations applied:</li>
</ul>
<table style="width:71%;">
<colgroup>
<col width="20%"></col>
<col width="25%"></col>
<col width="25%"></col>
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center"><strong>predicted 0</strong></th>
<th align="center"><strong>predicted 1</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>actual 0</strong></td>
<td align="center">0.93</td>
<td align="center">0.07</td>
</tr>
<tr class="even">
<td align="center"><strong>actual 1</strong></td>
<td align="center">0.27</td>
<td align="center">0.73</td>
</tr>
</tbody>
</table>
<p>The model trained on original data has higher predictive power - feature transformations have caused the loss of valuable information which was apparently used by the first model. However, within logistic regression models the significant improvement can be observed:</p>
<ul>
<li>for the original data:</li>
</ul>
<table style="width:71%;">
<colgroup>
<col width="20%"></col>
<col width="25%"></col>
<col width="25%"></col>
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center"><strong>predicted 0</strong></th>
<th align="center"><strong>predicted 1</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>actual 0</strong></td>
<td align="center">0.92</td>
<td align="center">0.08</td>
</tr>
<tr class="even">
<td align="center"><strong>actual 1</strong></td>
<td align="center">0.63</td>
<td align="center">0.37</td>
</tr>
</tbody>
</table>
<ul>
<li>for the data with <code>rSAFE</code> transformations applied:</li>
</ul>
<table style="width:71%;">
<colgroup>
<col width="20%"></col>
<col width="25%"></col>
<col width="25%"></col>
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center"><strong>predicted 0</strong></th>
<th align="center"><strong>predicted 1</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>actual 0</strong></td>
<td align="center">0.93</td>
<td align="center">0.07</td>
</tr>
<tr class="even">
<td align="center"><strong>actual 1</strong></td>
<td align="center">0.27</td>
<td align="center">0.73</td>
</tr>
</tbody>
</table>
<p>The initial logistic regression model has difficulties with “true negatives” - for employees that actually quit it very often predicts the opposite. On the other hand, <code>model_lr2</code> which was trained on the set of features modified by the SAFE algorithm has much better accuracy.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
